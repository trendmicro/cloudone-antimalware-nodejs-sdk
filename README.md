# AMaaS gRPC Node Client SDK

A TypeScript library for interacting with the AMaaS Service API.

## Prerequisites

- NodeJS (16.16.0+)
- [CloudOne API Key](https://cloudone.trendmicro.com/docs/identity-and-account-management/c1-api-key/)

## Test SDK

Two examples, one for CLI and one for AWS Lambda Function, are available under `/examples/` for testing the SDK.

### Use CLI example

1. Go to `/examples/cli/` in current directory.

   ```sh
   cd examples/cli/
   ```

2. Export environment variables. Substitute API KEY with CloudOne API KEY in the following commands.

   ```sh
   export TM_AM_SERVER_ADDR=test.amaastest.com:50051
   export TM_AM_AUTH_KEY=<API KEY>
   export TM_AM_AUTH_KEY_TYPE=apikey
   export TM_AM_LOG_LEVEL=<info | debug> # Optional
   ```

3. Install SDK dependency packages.

   ```sh
   npm install
   ```

4. Install AMaaS gRPC node client package.

   ```sh
   npm install ../../packages/output/pkg/amaas-amaas-grpc-node-client-1.0.0-1.tgz
   ```

5. Install type declaration package of AMaaS gRPC node client.

   ```sh
   npm install ../../packages/output/types/types-amaas__amaas-grpc-node-client-1.0.0-1.tgz
   ```

6. Build example.

   ```sh
   npm run build
   ```

7. Run example.

   ```sh
   npm run client
   ```

### Use Lambda example

1. Create a Lambda Function on AWS with following runtime settings.

   | Runtime                  | Handler       | Architecture    |
   | :----------------------- | :------------ | :-------------- |
   | Node.js 16.16.x or above | index.handler | x86_64 or arm64 |

2. Configure Lambda Function environment variables on AWS with following settings. Substitute API KEY with CloudOne API Key.

   | Key                 | Value                    | Optional |
   | :------------------ | :----------------------- | :------- |
   | TM_AM_SERVER_ADDR   | test.amaastest.com:50051 | No       |
   | TM_AM_AUTH_KEY      | \<API KEY\>              | No       |
   | TM_AM_AUTH_KEY_TYPE | apikey                   | No       |
   | TM_AM_LOG_LEVEL     | \<info \| debug \>       | Yes      |

3. Go to `/examples/lambda/` in current directory.

   ```sh
   cd examples/lambda/
   ```

4. Install SDK dependency packages.

   ```sh
   npm install
   ```

5. Install AMaaS gRPC node client package.

   ```sh
   npm install ../../packages/output/pkg/amaas-amaas-grpc-node-client-1.0.0-1.tgz
   ```

6. Install type declaration package of AMaaS gRPC node client.

   ```sh
   npm install ../../packages/output/types/types-amaas__amaas-grpc-node-client-1.0.0-1.tgz
   ```

7. Build example.

   ```sh
   npm run build
   ```

   - A zip file containing index.js and index.js.map will be generated under `/examples/lambda/dist/`.

8. Deploy `/examples/lambda/dist/index.zip` to Lambda Function created in step 1.

9. Create a test in Lambda Function and run the test.

## Version History

v1.0.0
## Change Log
