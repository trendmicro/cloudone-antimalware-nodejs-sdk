# syntax=docker/dockerfile:1
FROM node:16.10-slim@sha256:74a925c7c69748f3d93ba11d117d9ba0534369afd2187c6471238dce71320be3 as build_env

ARG TM_AM_NODE_JS_PKG
ARG TM_AM_TYPES_PKG
ARG TM_AM_TS_FILE

WORKDIR /app

## Install dependencies
COPY package.json ${TM_AM_NODE_JS_PKG} ${TM_AM_TYPES_PKG} /app/
RUN npm install

## Copy source codes
COPY tsconfig.json /app/
COPY src/ /app/src/

## Build example
RUN SOURCE=${TM_AM_TS_FILE} TM_AM_NODE_JS_PKG=${TM_AM_NODE_JS_PKG} TM_AM_TYPES_PKG=${TM_AM_TYPES_PKG} npm run build
